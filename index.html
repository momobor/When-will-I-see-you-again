<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Last Chapter â€” 2026</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,600;0,700;1,400;1,600&family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600&display=swap" rel="stylesheet">
<style>
:root {
  --peach:  #F7C59F;
  --coral:  #E07A5F;
  --gold:   #F2CC8F;
  --cream:  #FDFAF5;
  --warm:   #FAF3E8;
  --muted:  #C9A98A;
  --dark:   #2E1A0E;
  --mid:    #7A4F35;
  --shadow: rgba(224,122,95,0.18);
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html{font-size:16px;}
body{font-family:'DM Sans',-apple-system,sans-serif;background:var(--cream);color:var(--dark);min-height:100vh;-webkit-font-smoothing:antialiased;}

/* AUTH WALL */
.auth-wall{position:fixed;inset:0;z-index:1000;background:var(--cream);display:flex;align-items:center;justify-content:center;padding:24px;transition:opacity .4s;}
.auth-wall.hidden{opacity:0;pointer-events:none;}
.auth-box{text-align:center;max-width:340px;}
.auth-box h1{font-family:'Lora',Georgia,serif;font-size:2.4rem;font-weight:700;color:var(--dark);margin-bottom:8px;line-height:1.1;}
.auth-box h1 em{font-style:italic;color:var(--coral);}
.auth-box p{font-size:14px;color:var(--mid);margin-bottom:32px;line-height:1.6;}
.google-btn{display:inline-flex;align-items:center;gap:12px;background:white;border:1.5px solid var(--peach);border-radius:100px;padding:13px 28px;font-family:'DM Sans',sans-serif;font-size:15px;font-weight:600;color:var(--dark);cursor:pointer;transition:all .2s;box-shadow:0 3px 16px var(--shadow);}
.google-btn:hover{border-color:var(--coral);transform:translateY(-2px);box-shadow:0 6px 24px var(--shadow);}
.google-btn svg{width:20px;height:20px;flex-shrink:0;}
.auth-note{font-size:11px;color:var(--muted);margin-top:16px;line-height:1.5;}

/* USER BAR */
.user-bar{display:flex;align-items:center;justify-content:flex-end;gap:10px;padding:14px 24px;border-bottom:1px solid var(--peach);}
.user-avatar{width:32px;height:32px;border-radius:50%;border:1.5px solid var(--peach);object-fit:cover;}
.user-name{font-size:13px;font-weight:600;color:var(--mid);}
.sign-out-btn{font-size:12px;font-weight:600;color:var(--muted);background:none;border:1.5px solid var(--peach);border-radius:100px;padding:5px 14px;cursor:pointer;transition:all .2s;font-family:'DM Sans',sans-serif;}
.sign-out-btn:hover{border-color:var(--coral);color:var(--coral);}

/* HERO */
.hero{padding:56px 24px 40px;text-align:center;}
.eyebrow{font-size:11px;letter-spacing:2.5px;text-transform:uppercase;color:var(--coral);font-weight:600;margin-bottom:18px;}
.hero h1{font-family:'Lora',Georgia,serif;font-size:clamp(2.8rem,8vw,5.5rem);font-weight:700;color:var(--dark);line-height:1.05;margin-bottom:14px;}
.hero h1 em{font-style:italic;color:var(--coral);}
.hero-sub{font-size:15px;color:var(--mid);max-width:360px;margin:0 auto 36px;line-height:1.7;}

/* TOGGLE */
.toggle{display:inline-flex;background:white;border:1.5px solid var(--peach);border-radius:100px;padding:4px;gap:2px;}
.tog{padding:9px 20px;border-radius:100px;border:none;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .25s;color:var(--mid);background:transparent;}
.tog.active{background:var(--coral);color:white;box-shadow:0 2px 10px var(--shadow);}
.target-lbl{font-size:12px;color:var(--muted);margin-top:10px;font-weight:500;}

/* COUNTDOWN */
.countdown{display:flex;justify-content:center;gap:12px;flex-wrap:wrap;padding:40px 24px 8px;}
.cu{background:white;border:1.5px solid var(--peach);border-radius:20px;padding:24px 20px;text-align:center;min-width:100px;transition:transform .2s,box-shadow .2s;}
.cu:hover{transform:translateY(-4px);box-shadow:0 10px 28px var(--shadow);}
.cn{font-family:'Lora',Georgia,serif;font-size:3.2rem;font-weight:700;color:var(--coral);display:block;line-height:1;}
.cl{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:1.8px;color:var(--muted);margin-top:6px;}

/* MILESTONE */
.milestone{text-align:center;padding:20px 24px 48px;}
.ms{display:inline-block;font-size:14px;font-weight:500;color:var(--mid);background:var(--warm);border:1.5px solid var(--peach);border-radius:100px;padding:8px 22px;}

/* DIVIDER */
.divider{display:flex;align-items:center;gap:16px;padding:0 32px;margin-bottom:48px;}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--peach);}
.divider span{font-size:11px;color:var(--muted);white-space:nowrap;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;}

/* REEL */
.reel-hd{padding:0 32px 16px;max-width:900px;margin:0 auto;}
.reel-hd h2{font-family:'Lora',Georgia,serif;font-size:1.4rem;color:var(--dark);font-weight:600;margin-bottom:4px;}
.reel-hd p{font-size:12px;color:var(--muted);}
.reel-wrap{overflow:hidden;width:100%;position:relative;margin-bottom:8px;}
.reel-wrap::before,.reel-wrap::after{content:'';position:absolute;top:0;bottom:0;width:72px;z-index:2;pointer-events:none;}
.reel-wrap::before{left:0;background:linear-gradient(to right,var(--cream),transparent);}
.reel-wrap::after{right:0;background:linear-gradient(to left,var(--cream),transparent);}
.reel-track{display:flex;gap:12px;padding:8px 0;animation:slide 50s linear infinite;width:max-content;}
.reel-track:hover{animation-play-state:paused;}
@keyframes slide{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
.reel-card{width:175px;height:175px;border-radius:14px;flex-shrink:0;position:relative;overflow:hidden;border:1.5px solid var(--peach);transition:transform .3s,box-shadow .3s;cursor:pointer;}
.reel-card:hover{transform:scale(1.05);box-shadow:0 8px 24px rgba(0,0,0,0.12);}
.reel-card img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .4s;}
.reel-card:hover img{transform:scale(1.08);}
.reel-card .cap{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(to top,rgba(46,26,14,.65),transparent);padding:20px 10px 9px;font-size:10px;font-weight:600;color:white;opacity:0;transition:opacity .3s;line-height:1.3;}
.reel-card:hover .cap{opacity:1;}
.reel-ph{width:175px;height:175px;border-radius:14px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:2.5rem;border:1.5px solid var(--peach);background:var(--warm);}

/* MEMORY FORM */
.mem-sec{max-width:620px;margin:0 auto;padding:0 24px 64px;}
.mem-sec h2{font-family:'Lora',Georgia,serif;font-size:1.4rem;color:var(--dark);font-weight:600;margin-bottom:5px;}
.mem-sec>p{font-size:13px;color:var(--muted);margin-bottom:22px;}
.mem-form{background:white;border:1.5px solid var(--peach);border-radius:20px;padding:22px;display:flex;flex-direction:column;gap:12px;}

/* signed-in-as banner inside form */
.signed-as{display:flex;align-items:center;gap:10px;background:var(--warm);border-radius:11px;padding:10px 13px;}
.signed-as img{width:28px;height:28px;border-radius:50%;border:1.5px solid var(--peach);}
.signed-as span{font-size:13px;font-weight:600;color:var(--mid);}

.mem-form textarea{width:100%;padding:10px 13px;border:1.5px solid var(--peach);border-radius:11px;font-family:'DM Sans',sans-serif;font-size:14px;color:var(--dark);background:var(--cream);outline:none;transition:border-color .2s;min-height:84px;resize:none;line-height:1.6;appearance:none;}
.mem-form textarea:focus{border-color:var(--coral);}
.drop{border:2px dashed var(--peach);border-radius:12px;padding:18px;text-align:center;cursor:pointer;transition:all .2s;background:var(--warm);position:relative;}
.drop:hover,.drop.over{border-color:var(--coral);background:rgba(224,122,95,0.05);}
.drop input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.drop-ico{font-size:1.4rem;margin-bottom:5px;}
.drop-txt{font-size:13px;color:var(--mid);font-weight:500;}
.drop-hint{font-size:11px;color:var(--muted);margin-top:2px;}
.previews{display:flex;flex-wrap:wrap;gap:8px;}
.thumb{position:relative;width:62px;height:62px;border-radius:9px;overflow:hidden;border:1.5px solid var(--peach);}
.thumb img{width:100%;height:100%;object-fit:cover;}
.trm{position:absolute;top:2px;right:2px;width:17px;height:17px;border-radius:50%;border:none;background:rgba(46,26,14,.6);color:white;font-size:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:700;}
.mood-row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
.mood-lbl{font-size:12px;font-weight:600;color:var(--muted);}
.mo{font-size:1.2rem;cursor:pointer;padding:3px 7px;border-radius:7px;border:1.5px solid transparent;transition:all .15s;line-height:1;user-select:none;}
.mo:hover{background:var(--warm);border-color:var(--peach);}
.mo.sel{background:var(--warm);border-color:var(--coral);transform:scale(1.15);}
.form-foot{display:flex;justify-content:flex-end;align-items:center;gap:12px;}
.post-btn{background:var(--coral);color:white;border:none;border-radius:100px;padding:10px 24px;font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;box-shadow:0 3px 12px var(--shadow);}
.post-btn:hover{background:#c96a50;transform:translateY(-2px);}
.post-btn:disabled{opacity:.5;cursor:not-allowed;transform:none;}
.posting-lbl{font-size:12px;color:var(--muted);display:none;}

/* MEMORY CARDS */
.mem-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:13px;margin-top:26px;}
.mem-loading{text-align:center;padding:32px;font-size:13px;color:var(--muted);}
.mc{background:white;border:1.5px solid var(--peach);border-radius:16px;padding:16px;animation:fu .35s ease backwards;position:relative;}
@keyframes fu{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.mc-img{width:100%;height:130px;object-fit:cover;border-radius:10px;margin-bottom:10px;display:block;}
.mc-multi{display:grid;grid-template-columns:1fr 1fr;gap:3px;border-radius:10px;overflow:hidden;margin-bottom:10px;height:110px;}
.mc-multi img{width:100%;height:100%;object-fit:cover;display:block;}
.mc-header{display:flex;align-items:center;gap:8px;margin-bottom:8px;}
.mc-avatar{width:24px;height:24px;border-radius:50%;border:1.5px solid var(--peach);object-fit:cover;flex-shrink:0;}
.mc-avatar-ph{width:24px;height:24px;border-radius:50%;background:var(--peach);display:flex;align-items:center;justify-content:center;font-size:.7rem;flex-shrink:0;}
.mc-meta{min-width:0;}
.mc-name{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--muted);}
.mc-date{font-size:10px;color:var(--muted);}
.mc-emoji{font-size:1.3rem;margin-bottom:7px;}
.mc-text{font-size:13px;color:var(--dark);line-height:1.6;}
.mc-del{position:absolute;top:10px;right:10px;width:26px;height:26px;border-radius:50%;border:1.5px solid var(--peach);background:white;color:var(--muted);font-size:11px;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:0;transition:all .2s;font-weight:600;}
.mc:hover .mc-del{opacity:1;}
.mc-del:hover{background:#fee;border-color:#e07a5f88;color:var(--coral);}

/* CONFIRM MODAL */
.confirm-overlay{position:fixed;inset:0;z-index:400;background:rgba(46,26,14,.5);backdrop-filter:blur(5px);display:flex;align-items:center;justify-content:center;padding:20px;opacity:0;pointer-events:none;transition:opacity .2s;}
.confirm-overlay.open{opacity:1;pointer-events:all;}
.confirm-box{background:var(--cream);border-radius:20px;padding:28px;max-width:340px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.18);transform:scale(.95);transition:transform .25s cubic-bezier(.34,1.56,.64,1);text-align:center;}
.confirm-overlay.open .confirm-box{transform:scale(1);}
.confirm-icon{font-size:2rem;margin-bottom:12px;}
.confirm-title{font-family:'Lora',Georgia,serif;font-size:1.1rem;font-weight:600;color:var(--dark);margin-bottom:8px;}
.confirm-sub{font-size:13px;color:var(--muted);margin-bottom:22px;line-height:1.5;}
.confirm-btns{display:flex;gap:10px;justify-content:center;}
.cbtn{padding:9px 22px;border-radius:100px;border:1.5px solid var(--peach);font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;}
.cbtn.cancel{background:white;color:var(--mid);}
.cbtn.cancel:hover{background:var(--warm);}
.cbtn.danger{background:var(--coral);color:white;border-color:var(--coral);}
.cbtn.danger:hover{background:#c96a50;}

/* MIXTAPE */
.mix-section{max-width:620px;margin:0 auto;padding:0 24px 64px;}
.mix-section h2{font-family:'Lora',Georgia,serif;font-size:1.4rem;color:var(--dark);font-weight:600;margin-bottom:5px;}
.mix-section>p{font-size:13px;color:var(--muted);margin-bottom:22px;}
.mixtape{background:white;border:1.5px solid var(--peach);border-radius:20px;padding:22px;}
.now-playing{display:flex;align-items:center;gap:16px;margin-bottom:20px;}
.track-art{width:60px;height:60px;border-radius:12px;flex-shrink:0;background:linear-gradient(135deg,var(--peach),var(--coral));display:flex;align-items:center;justify-content:center;font-size:1.6rem;}
.track-art.spinning{animation:spin 4s linear infinite;}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.track-info{flex:1;min-width:0;}
.track-title{font-family:'Lora',Georgia,serif;font-size:1rem;font-weight:600;color:var(--dark);margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.track-artist{font-size:12px;color:var(--muted);}
.progress-wrap{margin-bottom:6px;cursor:pointer;height:4px;background:var(--peach);border-radius:100px;position:relative;}
.progress-fill{height:100%;background:var(--coral);border-radius:100px;width:0%;transition:width .5s linear;pointer-events:none;}
.time-row{display:flex;justify-content:space-between;font-size:10px;color:var(--muted);margin-bottom:16px;}
.controls{display:flex;align-items:center;justify-content:center;gap:14px;}
.ctrl-btn{width:36px;height:36px;border-radius:50%;border:1.5px solid var(--peach);background:white;color:var(--mid);font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;}
.ctrl-btn:hover{background:var(--peach);}
.ctrl-btn.play-btn{width:46px;height:46px;font-size:18px;background:var(--coral);color:white;border-color:var(--coral);box-shadow:0 3px 12px var(--shadow);}
.ctrl-btn.play-btn:hover{background:#c96a50;transform:scale(1.06);}
.track-list{margin-top:20px;display:flex;flex-direction:column;gap:2px;}
.track-row{display:flex;align-items:center;gap:12px;padding:9px 10px;border-radius:10px;cursor:pointer;transition:background .15s;}
.track-row:hover{background:var(--warm);}
.track-row.active{background:rgba(224,122,95,.1);}
.track-num{font-size:11px;color:var(--muted);width:16px;text-align:center;flex-shrink:0;}
.track-row.active .track-num{color:var(--coral);font-weight:700;}
.track-row-info{flex:1;min-width:0;display:flex;align-items:center;}
.track-row-text{min-width:0;}
.track-row-title{font-size:13px;font-weight:600;color:var(--dark);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.track-row.active .track-row-title{color:var(--coral);}
.track-row-artist{font-size:11px;color:var(--muted);}
.track-row-dur{font-size:11px;color:var(--muted);flex-shrink:0;}
.badge{font-size:9px;padding:2px 6px;border-radius:100px;font-weight:600;margin-left:6px;flex-shrink:0;}
.badge-shared{background:rgba(224,122,95,.12);color:var(--coral);}
.badge-local{background:rgba(168,230,207,.3);color:#4a9b6f;}
.add-song-toggle{margin-top:16px;width:100%;padding:9px;border:1.5px dashed var(--peach);border-radius:10px;background:transparent;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;color:var(--muted);cursor:pointer;transition:all .2s;}
.add-song-toggle:hover{border-color:var(--coral);color:var(--coral);background:rgba(224,122,95,.04);}
.add-song-note{font-size:11px;color:var(--muted);margin-top:7px;line-height:1.5;}
.add-song-form{margin-top:12px;display:none;flex-direction:column;gap:9px;}
.add-song-form.open{display:flex;}
.add-song-form input{padding:9px 13px;border:1.5px solid var(--peach);border-radius:10px;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--dark);background:var(--cream);outline:none;transition:border-color .2s;}
.add-song-form input:focus{border-color:var(--coral);}
.add-song-form input[type=file]{padding:7px 13px;cursor:pointer;}
.add-song-btn{padding:9px 18px;border-radius:100px;border:none;background:var(--coral);color:white;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;align-self:flex-end;}
.add-song-btn:hover{background:#c96a50;}

/* CALENDAR */
.cal-trig{text-align:center;padding:0 24px 64px;}
.cal-btn{display:inline-flex;align-items:center;gap:8px;border:1.5px solid var(--peach);border-radius:100px;padding:11px 26px;background:white;font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;color:var(--mid);cursor:pointer;transition:all .2s;}
.cal-btn:hover{background:var(--coral);color:white;border-color:var(--coral);box-shadow:0 4px 18px var(--shadow);}

/* MODAL */
.overlay{position:fixed;inset:0;z-index:200;background:rgba(46,26,14,.45);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;padding:20px;opacity:0;pointer-events:none;transition:opacity .25s;}
.overlay.open{opacity:1;pointer-events:all;}
.modal{background:var(--cream);border-radius:22px;width:100%;max-width:460px;max-height:88vh;overflow-y:auto;padding:26px;box-shadow:0 24px 64px rgba(0,0,0,.18);transform:translateY(18px) scale(.97);transition:transform .3s cubic-bezier(.34,1.56,.64,1);}
.overlay.open .modal{transform:translateY(0) scale(1);}
.modal-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
.modal-top h3{font-family:'Lora',Georgia,serif;font-size:1.25rem;color:var(--dark);font-weight:600;}
.xbtn{width:30px;height:30px;border-radius:50%;border:1.5px solid var(--peach);background:white;color:var(--mid);font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:600;transition:all .2s;}
.xbtn:hover{background:var(--coral);color:white;border-color:var(--coral);}
.cal-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;}
.nbtn{width:30px;height:30px;border-radius:50%;border:1.5px solid var(--peach);background:white;color:var(--mid);font-size:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;}
.nbtn:hover{background:var(--coral);color:white;border-color:var(--coral);}
.cal-ttl{font-family:'Lora',Georgia,serif;font-size:1.05rem;font-weight:600;color:var(--dark);}
.cgrid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;}
.dow{text-align:center;font-size:9px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--muted);padding:4px 0 7px;}
.day{aspect-ratio:1;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:500;color:var(--dark);transition:all .15s;position:relative;}
.day.ptr{cursor:pointer;}
.day.ptr:hover{background:var(--peach);}
.day.empty{pointer-events:none;}
.day.today{background:var(--coral);color:white;font-weight:700;}
.day.wknd{background:rgba(247,197,159,.28);color:var(--mid);}
.day.hol{background:rgba(242,204,143,.55);font-weight:600;}
.day.lb{background:rgba(168,230,207,.5);}
.day.lb.hol{background:rgba(168,230,207,.7);font-weight:600;}
.day.exam{background:rgba(255,179,198,.45);}
.day.lastday{background:var(--coral);color:white;font-weight:700;}
.day .pip{position:absolute;bottom:2px;width:4px;height:4px;border-radius:50%;background:var(--coral);}
.day.today .pip,.day.lastday .pip{background:white;}
.legend{margin-top:18px;display:flex;flex-wrap:wrap;gap:10px 14px;}
.leg{display:flex;align-items:center;gap:6px;font-size:11px;font-weight:500;color:var(--mid);}
.lsw{width:13px;height:13px;border-radius:4px;flex-shrink:0;}
.tip{position:fixed;z-index:300;pointer-events:none;background:var(--dark);color:white;padding:6px 11px;border-radius:9px;font-size:11px;font-weight:500;line-height:1.5;max-width:200px;white-space:pre-wrap;box-shadow:0 4px 14px rgba(0,0,0,.2);opacity:0;transition:opacity .15s;}
.tip.show{opacity:1;}
.cf{position:fixed;top:-12px;z-index:9999;pointer-events:none;border-radius:3px;animation:cff linear forwards;}
@keyframes cff{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(105vh) rotate(540deg);opacity:0}}
footer{text-align:center;padding:22px;font-size:12px;color:var(--muted);border-top:1px solid var(--peach);}
@media(max-width:480px){.cu{min-width:76px;padding:16px 10px;}.cn{font-size:2.4rem;}.reel-card,.reel-ph{width:148px;height:148px;}.hero h1{font-size:2.8rem;}}
</style>
</head>
<body>

<!-- AUTH WALL -->
<div class="auth-wall" id="authWall">
  <div class="auth-box">
    <h1>The <em>Last</em><br>Chapter</h1>
    <p>Sign in with Google to post memories and be part of the wall. It only takes a second.</p>
    <button class="google-btn" id="googleSignIn">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/>
        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
      </svg>
      Continue with Google
    </button>
    <p class="auth-note">Only your name and profile photo are used.<br>No other Google data is accessed.</p>
  </div>
</div>

<!-- USER BAR -->
<div class="user-bar" id="userBar" style="display:none;">
  <img class="user-avatar" id="userAvatar" src="" alt="">
  <span class="user-name" id="userName"></span>
  <button class="sign-out-btn" id="signOutBtn">Sign out</button>
</div>

<!-- HERO -->
<div class="hero">
  <div class="eyebrow">Class of 2026 &nbsp;Â·&nbsp; Final Semester</div>
  <h1>The <em>Last</em><br>Chapter</h1>
  <p class="hero-sub">Every class, every laugh, every late night â€” make them count.</p>
  <div class="toggle">
    <button class="tog active" id="togC" onclick="setMode('college')">Last College Day</button>
    <button class="tog"        id="togE" onclick="setMode('exams')">Last Exam Day</button>
  </div>
  <div class="target-lbl" id="tLbl">May 9, 2026 â€” last instruction day</div>
</div>

<!-- COUNTDOWN -->
<div class="countdown">
  <div class="cu"><span class="cn" id="cd">--</span><div class="cl">Days</div></div>
  <div class="cu"><span class="cn" id="ch">--</span><div class="cl">Hours</div></div>
  <div class="cu"><span class="cn" id="cm">--</span><div class="cl">Mins</div></div>
  <div class="cu"><span class="cn" id="cs">--</span><div class="cl">Secs</div></div>
</div>
<div class="milestone"><span class="ms" id="ms">â€¦</span></div>

<div class="divider"><span>memories</span></div>

<!-- REEL -->
<div class="reel-hd">
  <h2>Memory Reel</h2>
  <p>Hover to pause Â· Photos from everyone appear here</p>
</div>
<div class="reel-wrap" id="reelWrap" style="visibility:hidden;">
  <div class="reel-track" id="reel"></div>
</div>

<div class="divider" style="margin-top:40px;"><span>add yours</span></div>

<!-- MEMORY FORM -->
<div class="mem-sec">
  <h2>Leave a Memory</h2>
  <p>Write something, add a photo â€” everyone sees it instantly.</p>
  <div class="mem-form">
    <div class="signed-as" id="signedAs">
      <img src="" alt="" id="formAvatar">
      <span id="formName">Signed in</span>
    </div>
    <textarea id="mText" placeholder="Write a memory, a feeling, anythingâ€¦" maxlength="400"></textarea>
    <div class="drop" id="dz">
      <input type="file" id="fInput" accept="image/*" multiple>
      <div class="drop-ico">ğŸ–¼ï¸</div>
      <div class="drop-txt">Attach photos</div>
      <div class="drop-hint">Click to browse Â· optional</div>
    </div>
    <div class="previews" id="prevs"></div>
    <div class="mood-row">
      <span class="mood-lbl">Mood</span>
      <span class="mo sel" data-e="ğŸŒ…">ğŸŒ…</span>
      <span class="mo" data-e="ğŸ’›">ğŸ’›</span>
      <span class="mo" data-e="ğŸ˜­">ğŸ˜­</span>
      <span class="mo" data-e="ğŸ¥¹">ğŸ¥¹</span>
      <span class="mo" data-e="ğŸ‰">ğŸ‰</span>
      <span class="mo" data-e="ğŸ«‚">ğŸ«‚</span>
      <span class="mo" data-e="ğŸ”¥">ğŸ”¥</span>
    </div>
    <div class="form-foot">
      <span class="posting-lbl" id="postingLbl">Postingâ€¦</span>
      <button class="post-btn" id="postBtn">Post Memory</button>
    </div>
  </div>
  <div class="mem-loading" id="memLoading">Loading memoriesâ€¦</div>
  <div class="mem-grid" id="grid"></div>
</div>

<div class="divider"><span>mixtape</span></div>

<!-- MIXTAPE -->
<div class="mix-section">
  <h2>Our Mixtape ğŸµ</h2>
  <p>The songs that soundtrack these last days.</p>
  <div class="mixtape">
    <div class="now-playing">
      <div class="track-art" id="tArt">ğŸµ</div>
      <div class="track-info">
        <div class="track-title" id="tTitle">Select a track</div>
        <div class="track-artist" id="tArtist">â€”</div>
      </div>
    </div>
    <div class="progress-wrap" id="progWrap"><div class="progress-fill" id="progFill"></div></div>
    <div class="time-row"><span id="tCur">0:00</span><span id="tDur">0:00</span></div>
    <div class="controls">
      <button class="ctrl-btn" id="btnPrev">&#9664;&#9664;</button>
      <button class="ctrl-btn play-btn" id="btnPlay">&#9654;</button>
      <button class="ctrl-btn" id="btnNext">&#9654;&#9654;</button>
    </div>
    <div class="track-list" id="trackList"></div>
    <button class="add-song-toggle" id="addToggle">+ Add a song</button>
    <p class="add-song-note">Songs you add here are saved only on <em>your</em> device. Upload mp3s to GitHub to share with everyone.</p>
    <div class="add-song-form" id="addForm">
      <input type="text"  id="songTitle"  placeholder="Song title" maxlength="80">
      <input type="text"  id="songArtist" placeholder="Artist" maxlength="60">
      <input type="file"  id="songFile"   accept="audio/*">
      <button class="add-song-btn" id="addSongBtn">Add to mixtape</button>
    </div>
  </div>
</div>

<div class="divider"><span>plan</span></div>

<!-- CALENDAR -->
<div class="cal-trig">
  <button class="cal-btn" onclick="openCal()"><span>ğŸ“…</span> Holiday Calendar</button>
  <p style="font-size:12px;color:var(--muted);margin-top:9px;">Holidays, long weekends &amp; exam dates</p>
</div>

<footer>Class of 2026 Â· Your story isn't ending â€” it's graduating.</footer>

<!-- CALENDAR MODAL -->
<div class="overlay" id="ov">
  <div class="modal">
    <div class="modal-top">
      <h3>ğŸ“… Holiday Calendar</h3>
      <button class="xbtn" onclick="closeCal()">âœ•</button>
    </div>
    <div class="cal-nav">
      <button class="nbtn" onclick="navCal(-1)">â—€</button>
      <div class="cal-ttl" id="calTtl"></div>
      <button class="nbtn" onclick="navCal(1)">â–¶</button>
    </div>
    <div class="cgrid" id="cgrid"></div>
    <div class="legend">
      <div class="leg"><div class="lsw" style="background:rgba(242,204,143,.75)"></div>Holiday</div>
      <div class="leg"><div class="lsw" style="background:rgba(168,230,207,.75)"></div>Long weekend ğŸ‰</div>
      <div class="leg"><div class="lsw" style="background:rgba(255,179,198,.7)"></div>Exam period</div>
      <div class="leg"><div class="lsw" style="background:rgba(247,197,159,.4)"></div>Weekend</div>
      <div class="leg"><div class="lsw" style="background:var(--coral)"></div>Last day / Today</div>
    </div>
  </div>
</div>

<!-- CONFIRM DELETE -->
<div class="confirm-overlay" id="confirmOv">
  <div class="confirm-box">
    <div class="confirm-icon">ğŸ—‘ï¸</div>
    <div class="confirm-title">Delete this memory?</div>
    <div class="confirm-sub">This can't be undone. Are you sure?</div>
    <div class="confirm-btns">
      <button class="cbtn cancel" id="confirmCancel">Keep it</button>
      <button class="cbtn danger" id="confirmDelete">Yes, delete</button>
    </div>
  </div>
</div>

<div class="tip" id="tip"></div>

<script type="module">
import { initializeApp }          from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged }
                                   from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, orderBy, query, serverTimestamp }
                                   from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC0Z9TE_Rh5PThFNcW8kxuoR_ndP-BK80k",
  authDomain: "when-will-i-see-you-agai-3d0f9.firebaseapp.com",
  projectId: "when-will-i-see-you-agai-3d0f9",
  storageBucket: "when-will-i-see-you-agai-3d0f9.firebasestorage.app",
  messagingSenderId: "38360635362",
  appId: "1:38360635362:web:05629249e9904f506e8bbb"
};

const app      = initializeApp(firebaseConfig);
const auth     = getAuth(app);
const db       = getFirestore(app);
const MEM_COL  = collection(db, 'memories');
const provider = new GoogleAuthProvider();

let currentUser = null;

// â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('googleSignIn').addEventListener('click', () => {
  signInWithPopup(auth, provider).catch(e => console.error(e));
});
document.getElementById('signOutBtn').addEventListener('click', () => {
  signOut(auth);
});

onAuthStateChanged(auth, user => {
  currentUser = user;
  const wall    = document.getElementById('authWall');
  const userBar = document.getElementById('userBar');
  if (user) {
    wall.classList.add('hidden');
    userBar.style.display = 'flex';
    document.getElementById('userAvatar').src  = user.photoURL || '';
    document.getElementById('userName').textContent = user.displayName || user.email;
    document.getElementById('formAvatar').src  = user.photoURL || '';
    document.getElementById('formName').textContent = user.displayName || 'You';
  } else {
    wall.classList.remove('hidden');
    userBar.style.display = 'none';
  }
});

// â”€â”€ COUNTDOWN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const T_COLLEGE = new Date('2026-05-09T23:59:59');
const T_EXAMS   = new Date('2026-05-30T23:59:59');
let currentMode = 'college';
function pad(n){ return String(n).padStart(2,'0'); }
function getMilestone(d){
  if(d<=0)  return 'The chapter is complete.';
  if(d===1) return 'Tomorrow is the last day.';
  if(d<=7)  return d+' days left â€” make every one count.';
  if(d<=30) return d+' days â€” one last beautiful month.';
  if(d<=60) return d+' days â€” still so much to feel.';
  return d+' days remaining.';
}
function tick(){
  const t=currentMode==='college'?T_COLLEGE:T_EXAMS;
  const diff=Math.max(0,t-new Date());
  const dv=Math.floor(diff/864e5),hv=Math.floor(diff%864e5/36e5),
        mv=Math.floor(diff%36e5/6e4),sv=Math.floor(diff%6e4/1e3);
  document.getElementById('cd').textContent=pad(dv);
  document.getElementById('ch').textContent=pad(hv);
  document.getElementById('cm').textContent=pad(mv);
  document.getElementById('cs').textContent=pad(sv);
  document.getElementById('ms').textContent=getMilestone(dv);
}
window.setMode = v => {
  currentMode=v;
  document.getElementById('togC').classList.toggle('active',v==='college');
  document.getElementById('togE').classList.toggle('active',v==='exams');
  document.getElementById('tLbl').textContent=v==='college'
    ?'May 9, 2026 â€” last instruction day':'May 30, 2026 â€” last exam day';
  tick();
};
setInterval(tick,1000); tick();

// â”€â”€ REEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let reelPhotos=[];
function buildReel(){
  const track=document.getElementById('reel');
  const wrap=document.getElementById('reelWrap');
  track.innerHTML='';
  if(reelPhotos.length===0){ wrap.style.visibility='hidden'; return; }
  let pool=[...reelPhotos];
  while(pool.length<12) pool=[...pool,...reelPhotos];
  const makeCard=({src,caption})=>{
    const card=document.createElement('div'); card.className='reel-card';
    const img=document.createElement('img'); img.src=src; img.loading='lazy';
    const cap=document.createElement('div'); cap.className='cap'; cap.textContent=caption||'';
    card.appendChild(img); card.appendChild(cap); return card;
  };
  pool.forEach(p=>track.appendChild(makeCard(p)));
  pool.forEach(p=>track.appendChild(makeCard(p)));
  track.style.animation=`slide ${pool.length*4}s linear infinite`;
  wrap.style.visibility='visible';
}
}
function refreshReel(photos){ reelPhotos=photos; buildReel(); }
function clearReelPhotos(){ reelPhotos=[]; }

// â”€â”€ FILE STAGING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let staged=[];
document.getElementById('fInput').addEventListener('change',function(){ handleFiles(this.files); this.value=''; });
const dz=document.getElementById('dz');
dz.addEventListener('dragover', e=>{e.preventDefault();dz.classList.add('over');});
dz.addEventListener('dragleave',()=>dz.classList.remove('over'));
dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('over');handleFiles(e.dataTransfer.files);});
function compressImage(file, maxW=1200, quality=0.82){
  return new Promise(resolve=>{
    const img=new Image(), url=URL.createObjectURL(file);
    img.onload=()=>{
      URL.revokeObjectURL(url);
      const scale=Math.min(1, maxW/Math.max(img.width,img.height));
      const w=Math.round(img.width*scale), h=Math.round(img.height*scale);
      const c=document.createElement('canvas'); c.width=w; c.height=h;
      c.getContext('2d').drawImage(img,0,0,w,h);
      c.toBlob(b=>resolve(new File([b], file.name, {type:'image/jpeg'})),'image/jpeg',quality);
    };
    img.src=url;
  });
}

function handleFiles(files){
  [...files].forEach(async f=>{
    const compressed = await compressImage(f);
    const previewUrl = URL.createObjectURL(compressed);
    staged.push({file: compressed, previewUrl, nm: f.name.replace(/\.[^.]+$/,'')});
    renderPrev();
  });
}
function renderPrev(){
  const w=document.getElementById('prevs'); w.innerHTML='';
  staged.forEach((f,i)=>{
    const tw=document.createElement('div'); tw.className='thumb';
    const img=document.createElement('img'); img.src=f.previewUrl;
    const btn=document.createElement('button'); btn.className='trm'; btn.textContent='âœ•';
    btn.addEventListener('click',()=>{staged.splice(i,1);renderPrev();});
    tw.appendChild(img); tw.appendChild(btn); w.appendChild(tw);
  });
}

// â”€â”€ MOOD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentMood='ğŸŒ…';
document.querySelectorAll('.mo').forEach(el=>{
  el.addEventListener('click',()=>{
    document.querySelectorAll('.mo').forEach(e=>e.classList.remove('sel'));
    el.classList.add('sel'); currentMood=el.dataset.e;
  });
});

// â”€â”€ POST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CARD_BG=['#FFF8F0','#FFFDF0','#FFF0F4','#F0FFF8','#F0F4FF','#FFF0FA'];
let bgIdx=0;

document.getElementById('postBtn').addEventListener('click', async ()=>{
  if(!currentUser){ alert('Please sign in first.'); return; }
  const text=document.getElementById('mText').value.trim();
  if(!text && staged.length===0){
    document.getElementById('mText').style.borderColor='var(--coral)'; return;
  }
  document.getElementById('mText').style.borderColor='var(--peach)';
  const btn=document.getElementById('postBtn');
  const lbl=document.getElementById('postingLbl');
  btn.disabled=true; lbl.style.display='inline'; lbl.textContent='Compressingâ€¦';
  try{
    await addDoc(MEM_COL,{
      uid:    currentUser.uid,
      name:   currentUser.displayName || currentUser.email,
      avatar: currentUser.photoURL || '',
      text,
      mood:   currentMood,
      photos: await Promise.all(staged.map(f=> new Promise((resolve,reject)=>{
  const r=new FileReader();
  r.onload=e=>{
    const base64=e.target.result;
    if(base64.length > 700000){
      reject(new Error(`"${f.nm}" is still too large. Try a smaller or cropped image.`));
    } else {
      resolve({url: base64, nm: f.nm});
    }
  };
  r.onerror=reject;
  r.readAsDataURL(f.file);
}))),
      date:   new Date().toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'numeric'}),
      ts:     serverTimestamp()
    });
    document.getElementById('mText').value='';
    staged=[]; renderPrev();
    confetti();
  } catch(e){ alert(e.message || 'Could not post â€” check your internet connection.'); }
  btn.disabled=false; lbl.style.display='none';
});

// â”€â”€ REALTIME MEMORIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const q=query(MEM_COL,orderBy('ts','desc'));
onSnapshot(q, snapshot=>{
  const grid=document.getElementById('grid');
  document.getElementById('memLoading').style.display='none';
  grid.innerHTML=''; bgIdx=0;
  clearReelPhotos();
  const allReelPhotos=[];
  snapshot.docs.forEach(docSnap=>{
    const m=docSnap.data();
    if(m.photos) m.photos.forEach(p=>allReelPhotos.push({src:p.url,caption:m.name+' Â· '+p.nm}));
  });
  refreshReel(allReelPhotos);

  snapshot.docs.forEach(docSnap=>{
    const m=docSnap.data(), id=docSnap.id;

    const card=document.createElement('div');
    card.className='mc';
    card.style.background=CARD_BG[bgIdx++%CARD_BG.length];
    let html='';

    // photos
    if(m.photos&&m.photos.length===1)
      html+=`<img class="mc-img" src="${m.photos[0].url}" alt="">`;
    else if(m.photos&&m.photos.length>1)
      html+=`<div class="mc-multi">${m.photos.slice(0,4).map(p=>`<img src="${p.url}" alt="">`).join('')}</div>`;

    html+=`<div class="mc-emoji">${m.mood||'ğŸŒ…'}</div>`;

    // header with avatar
    const avatarHtml = m.avatar
      ? `<img class="mc-avatar" src="${m.avatar}" alt="">`
      : `<div class="mc-avatar-ph">ğŸ‘¤</div>`;
    html+=`<div class="mc-header">${avatarHtml}<div class="mc-meta"><div class="mc-name">${esc(m.name)}</div><div class="mc-date">${m.date||''}</div></div></div>`;

    if(m.text) html+=`<div class="mc-text">${esc(m.text)}</div>`;
    card.innerHTML=html;

    // delete button â€” only for own posts
    if(currentUser && m.uid===currentUser.uid){
      const del=document.createElement('button'); del.className='mc-del'; del.textContent='âœ•';
      del.addEventListener('click',e=>{e.stopPropagation();openConfirm(id);});
      card.appendChild(del);
    }
    grid.appendChild(card);
  });
});

function esc(s){ if(!s)return''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// â”€â”€ CONFIRM DELETE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let pendingId=null;
function openConfirm(id){ pendingId=id; document.getElementById('confirmOv').classList.add('open'); }
function closeConfirm(){ pendingId=null; document.getElementById('confirmOv').classList.remove('open'); }
document.getElementById('confirmCancel').addEventListener('click',closeConfirm);
document.getElementById('confirmOv').addEventListener('click',e=>{ if(e.target.id==='confirmOv') closeConfirm(); });
document.getElementById('confirmDelete').addEventListener('click', async ()=>{
  if(!pendingId) return;
  try{ await deleteDoc(doc(db,'memories',pendingId)); }
  catch(e){ alert('Could not delete â€” check your connection.'); }
  closeConfirm();
});

// â”€â”€ CONFETTI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function confetti(){
  const cols=['#E07A5F','#F2CC8F','#F7C59F','#FFB3C6','#A8E6CF'];
  for(let i=0;i<35;i++){
    const el=document.createElement('div'); el.className='cf';
    const dur=(1.3+Math.random()*1.6).toFixed(2),del=(Math.random()*.35).toFixed(2);
    const col=cols[~~(Math.random()*cols.length)];
    const w=(5+Math.random()*6).toFixed(0),h=(7+Math.random()*9).toFixed(0);
    const rot=~~(Math.random()*360),rad=Math.random()>.5?'50%':'3px';
    el.style.cssText=`left:${(Math.random()*100).toFixed(1)}vw;width:${w}px;height:${h}px;background:${col};animation-duration:${dur}s;animation-delay:${del}s;transform:rotate(${rot}deg);border-radius:${rad};`;
    document.body.appendChild(el);
    setTimeout(()=>el.remove(),3000);
  }
}

// â”€â”€ MIXTAPE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TAPE_KEY='lc_tape_local';
const tapeAudio=new Audio();
let tapeIdx=0,tapePlaying=false;
const BASE_TRACKS=[
  {title:'See You Again',artist:'Wiz Khalifa ft. Charlie Puth',url:'See%20You%20Again%20ft.%20Charlie%20Puth.mp3',dur:'3:50',base:true},
  {title:'The Final Countdown',artist:'Europe',url:'The%20Final%20Countdown.mp3',dur:'5:09',base:true},
];
function loadLocalTape(){ try{return JSON.parse(localStorage.getItem(TAPE_KEY)||'[]');}catch(e){return[];} }
function saveLocalTape(a){ try{localStorage.setItem(TAPE_KEY,JSON.stringify(a));}catch(e){} }
function loadTape(){ return BASE_TRACKS.concat(loadLocalTape()); }
const EMOJIS=['ğŸµ','ğŸ¶','ğŸŒ…','ğŸ’›','ğŸŒ™','â˜•','ğŸ­','âœ¨','ğŸ”¥','ğŸŒ¸'];
function renderTrackList(){
  const tape=loadTape(),list=document.getElementById('trackList');
  list.innerHTML='';
  tape.forEach((t,i)=>{
    const row=document.createElement('div');
    row.className='track-row'+(i===tapeIdx?' active':'');
    const badge=t.base?'<span class="badge badge-shared">shared</span>':'<span class="badge badge-local">your device</span>';
    row.innerHTML=`<div class="track-num">${i===tapeIdx?'â™ª':(i+1)}</div>
      <div class="track-row-info"><div class="track-row-text">
        <div class="track-row-title">${esc(t.title)}</div>
        <div class="track-row-artist">${esc(t.artist)}</div>
      </div>${badge}</div>
      <div class="track-row-dur">${t.dur||''}</div>`;
    row.addEventListener('click',()=>loadTrack(i,true));
    list.appendChild(row);
  });
}
function loadTrack(i,autoplay){
  const tape=loadTape(); if(!tape.length)return;
  tapeIdx=((i%tape.length)+tape.length)%tape.length;
  const t=tape[tapeIdx];
  document.getElementById('tTitle').textContent=t.title;
  document.getElementById('tArtist').textContent=t.artist||'â€”';
  document.getElementById('tArt').textContent=EMOJIS[tapeIdx%EMOJIS.length];
  tapeAudio.src=t.url; tapeAudio.load();
  document.getElementById('progFill').style.width='0%';
  document.getElementById('tCur').textContent='0:00';
  document.getElementById('tDur').textContent='0:00';
  renderTrackList();
  if(autoplay){tapeAudio.play();setPlaying(true);}
}
function setPlaying(state){
  tapePlaying=state;
  document.getElementById('btnPlay').innerHTML=state?'&#9646;&#9646;':'&#9654;';
  const art=document.getElementById('tArt');
  state?art.classList.add('spinning'):art.classList.remove('spinning');
}
document.getElementById('btnPlay').addEventListener('click',()=>{
  const tape=loadTape(); if(!tape.length)return;
  if(!tapeAudio.src||tapeAudio.src===window.location.href){loadTrack(0,true);return;}
  tapePlaying?(tapeAudio.pause(),setPlaying(false)):(tapeAudio.play(),setPlaying(true));
});
document.getElementById('btnPrev').addEventListener('click',()=>loadTrack(tapeIdx-1,tapePlaying));
document.getElementById('btnNext').addEventListener('click',()=>loadTrack(tapeIdx+1,tapePlaying));
tapeAudio.addEventListener('timeupdate',()=>{
  if(!tapeAudio.duration)return;
  document.getElementById('progFill').style.width=(tapeAudio.currentTime/tapeAudio.duration*100)+'%';
  document.getElementById('tCur').textContent=fmtTime(tapeAudio.currentTime);
  document.getElementById('tDur').textContent=fmtTime(tapeAudio.duration);
});
tapeAudio.addEventListener('ended',()=>loadTrack(tapeIdx+1,true));
tapeAudio.addEventListener('pause',()=>setPlaying(false));
tapeAudio.addEventListener('play', ()=>setPlaying(true));
document.getElementById('progWrap').addEventListener('click',e=>{
  if(!tapeAudio.duration)return;
  const r=document.getElementById('progWrap').getBoundingClientRect();
  tapeAudio.currentTime=((e.clientX-r.left)/r.width)*tapeAudio.duration;
});
function fmtTime(s){ if(isNaN(s))return'0:00'; return Math.floor(s/60)+':'+(Math.floor(s%60)<10?'0':'')+Math.floor(s%60); }
document.getElementById('addToggle').addEventListener('click',function(){
  const f=document.getElementById('addForm'); f.classList.toggle('open');
  this.textContent=f.classList.contains('open')?'âˆ’ Cancel':'+ Add a song';
});
document.getElementById('addSongBtn').addEventListener('click',()=>{
  const title=document.getElementById('songTitle').value.trim();
  const artist=document.getElementById('songArtist').value.trim();
  const file=document.getElementById('songFile').files[0];
  if(!title||!file){
    if(!title)document.getElementById('songTitle').style.borderColor='var(--coral)';
    if(!file) document.getElementById('songFile').style.borderColor='var(--coral)';
    return;
  }
  document.getElementById('songTitle').style.borderColor='var(--peach)';
  document.getElementById('songFile').style.borderColor='var(--peach)';
  const reader=new FileReader();
  reader.onload=e=>{
    const tmp=new Audio(); tmp.src=e.target.result;
    tmp.addEventListener('loadedmetadata',()=>{
      const local=loadLocalTape();
      local.push({title,artist:artist||'Unknown',url:e.target.result,dur:fmtTime(tmp.duration),base:false});
      saveLocalTape(local);
      document.getElementById('songTitle').value='';
      document.getElementById('songArtist').value='';
      document.getElementById('songFile').value='';
      document.getElementById('addForm').classList.remove('open');
      document.getElementById('addToggle').textContent='+ Add a song';
      renderTrackList();
    });
  };
  reader.readAsDataURL(file);
});
renderTrackList();

// â”€â”€ CALENDAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const HOL={
  '2026-01-15':'Uttarayana Punyakala, Makara Sankranti','2026-01-16':'Special holiday',
  '2026-01-24':'Saturday off','2026-01-26':'Republic Day','2026-02-21':'Saturday off',
  '2026-03-19':'Chandramana Ugadi','2026-03-20':'Special holiday','2026-03-21':'Khutub-E-Ramzan',
  '2026-03-31':'Mahaveera Jayanthi','2026-04-03':'Good Friday','2026-04-04':'Saturday off',
  '2026-04-14':'Dr. B.R. Ambedkar Jayanthi','2026-04-20':'Basava Jayanthi, Akshaya Tritiya',
  '2026-05-01':'Labour Day / May Day','2026-05-02':'Saturday off','2026-05-28':'Bakrid',
  '2026-06-26':'Day of Muharram (Ashura)','2026-06-27':'Saturday off','2026-07-18':'Saturday off',
  '2026-08-15':'Independence Day','2026-08-21':'Varamahalakshmi Vrata (restricted)',
  '2026-08-22':'Saturday off / Special holiday','2026-08-26':'Eid-Milad',
  '2026-09-14':'Swarnagowri Vratam / Varasiddhi Vinayaka Vrata','2026-09-19':'Saturday off',
  '2026-10-02':'Gandhi Jayanthi','2026-10-10':'Mahalaya Amavasye','2026-10-19':'Special holiday',
  '2026-10-20':'Maha Navami, Ayudhapooja','2026-10-21':'Vijayadashami','2026-11-09':'Special holiday',
  '2026-11-10':'Balipadyami, Deepavali','2026-11-27':'Kanakadasa Jayanthi',
  '2026-12-19':'Saturday off','2026-12-25':'Christmas'
};
const AC={
  '2026-05-09':'Last instruction day ğŸ“','2026-05-14':'Examinations begin',
  '2026-05-22':'Examinations begin (2nd sem)','2026-05-30':'Last exam day',
  '2026-06-05':'Last exam day (2nd sem)'
};
const MONTHS=['January','February','March','April','May','June','July','August','September','October','November','December'];
let cy=2026,cm_cal=0;
function dk(y,mo,d){return`${y}-${String(mo+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;}
function isLongBreak(y,mo,d){
  let n=0;
  for(let o=-2;o<=2;o++){const nd=new Date(y,mo,d+o);const k=dk(nd.getFullYear(),nd.getMonth(),nd.getDate());if(nd.getDay()===0||nd.getDay()===6||HOL[k])n++;}
  return n>=3;
}
function renderCal(){
  document.getElementById('calTtl').textContent=MONTHS[cm_cal]+' '+cy;
  const grid=document.getElementById('cgrid'); grid.innerHTML='';
  ['S','M','T','W','T','F','S'].forEach(d=>{const el=document.createElement('div');el.className='dow';el.textContent=d;grid.appendChild(el);});
  const first=new Date(cy,cm_cal,1).getDay(),total=new Date(cy,cm_cal+1,0).getDate(),now=new Date();
  for(let i=0;i<first;i++){const el=document.createElement('div');el.className='day empty';grid.appendChild(el);}
  for(let d=1;d<=total;d++){
    const el=document.createElement('div');el.className='day';el.textContent=d;
    const k=dk(cy,cm_cal,d),dow=new Date(cy,cm_cal,d).getDay();
    const isToday=now.getFullYear()===cy&&now.getMonth()===cm_cal&&now.getDate()===d;
    const isWk=dow===0||dow===6,isH=!!HOL[k],isLast=k==='2026-05-09';
    const inEx=cy===2026&&cm_cal===4&&d>=14&&d<=30,lb=isLongBreak(cy,cm_cal,d);
    const tips=[];
    if(isToday)           {el.classList.add('today');  tips.push('Today');}
    else if(isLast)       {el.classList.add('lastday');tips.push('Last college day ğŸ“');}
    else if(inEx)         {el.classList.add('exam');   tips.push('Exam period');}
    else if(lb&&(isH||isWk)){el.classList.add('lb');  if(isWk&&!isH)tips.push('Long weekend ğŸ‰');}
    else if(isH)          {el.classList.add('hol');}
    else if(isWk)         {el.classList.add('wknd');}
    if(HOL[k])tips.push(HOL[k]);
    if(AC[k]) tips.push(AC[k]);
    if(tips.length){
      const pip=document.createElement('div');pip.className='pip';el.appendChild(pip);el.classList.add('ptr');
      const txt=tips.join('\n');
      el.addEventListener('mouseenter',e=>showTip(e,txt));
      el.addEventListener('mouseleave',hideTip);
    }
    grid.appendChild(el);
  }
}
const tipEl=document.getElementById('tip');
function showTip(e,t){tipEl.textContent=t;tipEl.classList.add('show');moveTip(e);}
function hideTip(){tipEl.classList.remove('show');}
function moveTip(e){tipEl.style.left=(e.clientX+12)+'px';tipEl.style.top=(e.clientY-38)+'px';}
document.addEventListener('mousemove',e=>{if(tipEl.classList.contains('show'))moveTip(e);});
window.openCal=()=>{const n=new Date();cy=n.getFullYear();cm_cal=n.getMonth();renderCal();document.getElementById('ov').classList.add('open');};
window.closeCal=()=>document.getElementById('ov').classList.remove('open');
document.getElementById('ov').addEventListener('click',e=>{if(e.target.id==='ov')window.closeCal();});
window.navCal=dir=>{cm_cal+=dir;if(cm_cal>11){cm_cal=0;cy++;}if(cm_cal<0){cm_cal=11;cy--;}renderCal();};
</script>
</body>
</html>
